# Language setting
language: node_js

env:
  global:
    - PORT=8080
    - APP_NAME=learning-phaser
    - secure: THSjBVRonqA6UXzzDDg5S5vWw7ktUKY6sLFgL5r6eJWA+7C1kB7yNEeCdGTehITQ447NGDynDiPD1WA8siXSYXPtleK0zTOqdNPEEVhVlMxUvF1V1DqJB/TgigWQJfeiY/VR7PCmc2BIGOgZ5GoXg/xpn0zzqg+eNam63CWnsbZ1fP3V6No7TcB3XGcruhcwdC2QsvUkjIl54veiIWWsj58xaeGLjOG6gG8uRMyELSQGGrHtPaiYNn8jaEMubOwIDSSuJvqIPNvjuhl+9HffrlUHTyP8A40XkFOScMHAbnjVU7kW/6JCJe+UNrYBB3KDB37Oat9m/JQZhqCk3CCITQ==

build:
  pre_ci:
    - echo "this is master branch"

  ci:
    - which heroku || wget -qO- https://toolbelt.heroku.com/install-ubuntu.sh | sh
    - npm install
    - npm test
    - docker build -f Dockerfile-cordova -t cordova .
    - alias mine='sudo chown -R $USER'
    - alias drun='docker run -it --rm'
    - alias cordova='drun --privileged -v /dev/bus/usb:/dev/bus/usb -v $PWD:/src cordova cordova'
    - cordova create hello
    - cd hello
    - cordova platform add android
    - cordova plugin add cordova-plugin-crosswalk-webview
    - cordova build android

  post_ci:
    - ls -a
    - pwd

  on_success:
    - test -f ~/.ssh/id_rsa.heroku || ssh-keygen -y -f /tmp/ssh/00_sub > ~/.ssh/id_rsa.heroku && heroku keys:add ~/.ssh/id_rsa.heroku
    - git remote -v | grep ^heroku || heroku git:remote --ssh-git --app $APP_NAME
    - git push -f heroku master

  cache: true

  cache_dir_list:
    - $SHIPPABLE_BUILD_DIR/node_modules
